FROM python:3.7

RUN mkdir -p /usr/src/app
WORKDIR /usr/src/app

RUN mkdir -p /var/run/secrets/kubeflow/pipelines
RUN echo 'eyJhbGciOiJSUzI1NiIsImtpZCI6ImFJMjVtaWhrbUN1Vm5QNFB6ZnNkNGhFN2Q4TjlfSlpxT0tZN2Z1RGhZaWsifQ.eyJhdWQiOlsicGlwZWxpbmVzLmt1YmVmbG93Lm9yZyJdLCJleHAiOjE2OTI2OTc3MjQsImlhdCI6MTY5MjY5MDUyNCwiaXNzIjoiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJhZG1pbiIsInBvZCI6eyJuYW1lIjoiZWx5cmEtMCIsInVpZCI6ImNjYzJhMzlkLTJlNTUtNDhmOC04NmI2LTM1NzMzZWM0NWI0MyJ9LCJzZXJ2aWNlYWNjb3VudCI6eyJuYW1lIjoiZGVmYXVsdC1lZGl0b3IiLCJ1aWQiOiI3ZTU4YzI0ZC0wYzk0LTQ0YmUtOTczNS0xZjllYTE3ZmZjNjAifX0sIm5iZiI6MTY5MjY5MDUyNCwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmFkbWluOmRlZmF1bHQtZWRpdG9yIn0.ocY3evabAmm4NtHSCmmOePp5VbYIqwHj3d0o1UfMe8AVu5dKmd6zU_rRLvx3HQjOsgTu-zxqQE7_Wfm8qIXaUguCP1_MAppey2O5jiLjbwxOo6gGNzMROTRPnktjW3o1MlK1n2avUv1PP-yltIrrtr0rAl6uDGNVgQgrPwzyC8reqL1j9o9NycD-9yw1rr20aSVl8VXCEWshS85BYBPMleBbrhTF6sDrWQhbb8RDrZlVWwkdanHSigXHjhxrtWEIHhzDRad3Biu3JuQhyv_byMaFp0XXfenV4jewqa5aSwcQsa-uY48xKz90eh-a50muGW8GvndReai1cas2NRGBFQ' > /var/run/secrets/kubeflow/pipelines/token

RUN pip3 install requests
RUN pip3 install kfp==1.8.21
RUN pip3 install Flask

COPY . /usr/src/app

EXPOSE 5000

ENTRYPOINT ["python3"]

CMD ["-m", "flask", "--app", "src", "run", "--host=0.0.0.0"]