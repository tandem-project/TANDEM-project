  - name: On the host server, install the latest nfs-kernel-server package
    ansible.builtin.apt:
      name: nfs-kernel-server
      state: latest
      update_cache: yes
    become: true
    environment:
      http_proxy: http://icache.intracomtel.com:80/

  - name: Exporting a general purpose mount - no special privileges on client machine
    ansible.builtin.file:
      path: "{{ item }}"
      state: directory
      owner: nobody
      group: nogroup
    with_items:
      - /opt/certs
      - /opt/registry
    become: true

  - name: Configure the NFS Exports on Host Server (rw - gives to client computer both read and write access into the volume
    ansible.builtin.lineinfile:
      path: "/etc/exports"
      line: "{{ item }}"
      create: yes
    with_items:
       - "/opt/certs *(rw,sync,no_subtree_check)"
       - "/opt/registry *(rw,sync,no_subtree_check)"
    become: true

  - name: Restart the NFS server
    ansible.builtin.service:
      name: nfs-kernel-server
      state: restarted
      enabled: true
    become: true
